<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>京东物流 V1.0 法定预测报告</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial;
      margin:18px;background:#f6f7f9;color:#111
    }
    .wrap{max-width:1480px;margin:0 auto}
    .card{background:#fff;border:1px solid #e6e8eb;border-radius:12px;padding:18px;margin:14px 0;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    h1{font-size:22px;margin:0 0 10px 0}
    .meta{font-size:13px;color:#555;line-height:1.6}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .badge{background:#f1f3f5;border:1px solid #e6e8eb;border-radius:10px;padding:6px 10px;font-size:13px;color:#333}
    .btn{cursor:pointer;border:1px solid #e6e8eb;background:#fff;border-radius:10px;padding:8px 12px;font-size:13px}
    .err{color:#b42318}
    .hint{font-size:12px;color:#666;margin-top:8px}
    pre{white-space:pre-wrap;word-break:break-word;margin:12px 0 0 0;font-size:13px;line-height:1.55}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <h1>京东物流 V1.0 法定预测报告</h1>
        <div class="row">
          <button class="btn" onclick="loadReport()">刷新数据</button>
          <span class="badge" id="status">状态：加载中…</span>
        </div>
      </div>

      <div id="meta" class="meta">正在加载 latest_report.json ...</div>
      <div class="hint">说明：本页每次打开都会自动拉取最新 latest_report.json（已禁用缓存），保证“打开即最新”。</div>

      <pre id="out"></pre>
    </div>
  </div>

<script>
async function loadReport(){
  const meta = document.getElementById('meta');
  const out  = document.getElementById('out');
  const status = document.getElementById('status');

  try{
    status.textContent = '状态：抓取中…';

    // ✅ 打开即最新关键：禁用缓存 + URL 加时间戳
    const url = 'latest_report.json?t=' + Date.now();
    const r = await fetch(url, { cache: 'no-store' });
    if(!r.ok) throw new Error('HTTP ' + r.status + ' ' + r.statusText);

    const data = await r.json();

    // 兼容字段（不改你JSON结构也能显示）
    const symbol = data.symbol || data.code || data.ticker || '02618.HK';
    const date   = data.date || data.trade_date || data.trading_date || '未知';
    const genTs  = data.generated_at || data.generatedAt || data.report_time || '';

    meta.innerHTML = `
      <div class="row">
        <div class="badge">代码：${symbol}</div>
        <div class="badge">时间：${date}</div>
        <div class="badge">页面刷新：${new Date().toISOString()}</div>
      </div>
      <div style="margin-top:8px">
        数据源：/latest_report.json（no-store + 时间戳防缓存）
        ${genTs ? `｜报告生成时间：${genTs}` : ``}
      </div>
    `;

    // 先原样展示，确保“永远最新”链路 100% 稳
    out.textContent = JSON.stringify(data, null, 2);

    status.textContent = '状态：已更新 ✅';
  }catch(e){
    status.textContent = '状态：失败 ❌';
    meta.innerHTML = `<div class="err">加载失败：${e.message}</div>
      <div class="meta">请确认仓库根目录存在 latest_report.json，并且 GitHub Pages 已发布到 root。</div>`;
    out.textContent = '';
  }
}

// ✅ 打开页面自动执行一次 = “打开即最新”
loadReport();
</script>
</body>
</html>
